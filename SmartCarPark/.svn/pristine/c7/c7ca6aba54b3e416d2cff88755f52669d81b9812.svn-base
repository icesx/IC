/*
 * Sim900a.h
 *
 *  Created on: 2015年8月6日
 *      Author: i
 */
#ifndef Sim900a_H_
#define Sim900a_H_
#include <Arduino.h>
#include <SoftwareSerial.h>
#define SIM900A_PIN 5
struct Sim900aParam {
	int port;
	char* server;
	char* url;
	Stream* mySerial;
};
class Sim900a {
public:
	Sim900a(Sim900aParam* sim900aParam) {
		this->param = sim900aParam;
		HTTP_METHOD == "GET / \r\n";
		SEND_FLAG == "\x1A";
	}
	void prepare();
	void reconnect();
	char* transform(char * code);
	~Sim900a() {

	}
private:
	inline void runCommand(char* ATcommand);
	inline void sendATcommandTimeout(char* ATcommand, char* okFlag,
			unsigned int timeout, boolean retry);
	inline char* readFromMySerial();
	inline char* readFromMySerial(int timeout, char* okFlag);
	inline void close_connect();
	void sendCode(char*code);
	Sim900aParam* param;
	int previous;
	char HTTP_METHOD[10];
	//\x1A=ctrl+z
	char SEND_FLAG[2];
	char response[100];
};
#endif
